{% assign lang = page.lang | default: 'en' %}

{%- comment -%}
Normalise URL:
- remove language prefix
- remove /index.html
- remove trailing slash
Result examples:
  /ru/work/index.html -> /work
  /de/notes/ -> /notes
  / -> /
{%- endcomment -%}
{% assign path = page.url
  | remove_first: '/de'
  | remove_first: '/ru'
  | remove: '/index.html'
  | replace: '//', '/'
%}

{% if path != '/' %}
  {% assign path = path | remove_last: '/' %}
{% endif %}

{%- comment -%}
Extract section key:
  /work -> work
  /notes -> notes
  / -> home
{%- endcomment -%}
{% if path == '/' %}
  {% assign section = 'home' %}
{% else %}
  {% assign section = path | split: '/' | last %}
{% endif %}

{%- comment -%}
Base prefix for links
{%- endcomment -%}
{% if lang == 'en' %}
  {% assign base = '' %}
{% else %}
  {% assign base = '/' | append: lang %}
{% endif %}

<header class="site-header">
  <div class="nav-inner">

    <div class="nav-spacer"></div>

    <nav class="site-nav">

      <a href="{{ base }}/"
         class="{% if section == 'home' %}active{% endif %}">
        {% if lang == 'de' %}Start{% elsif lang == 'ru' %}Главная{% else %}Home{% endif %}
      </a>

      <a href="{{ base }}/about"
         class="{% if section == 'about' %}active{% endif %}">
        {% if lang == 'de' %}Über{% elsif lang == 'ru' %}Обо мне{% else %}About{% endif %}
      </a>

      <a href="{{ base }}/work"
         class="{% if section == 'work' %}active{% endif %}">
        {% if lang == 'de' %}Arbeit{% elsif lang == 'ru' %}Работа{% else %}Work{% endif %}
      </a>

      <a href="{{ base }}/notes"
         class="{% if section == 'notes' %}active{% endif %}">
        {% if lang == 'de' %}Notizen{% elsif lang == 'ru' %}Заметки{% else %}Notes{% endif %}
      </a>

      <a href="{{ base }}/research"
         class="{% if section == 'research' %}active{% endif %}">
        {% if lang == 'de' %}Forschung{% elsif lang == 'ru' %}Исследования{% else %}Research{% endif %}
      </a>

    </nav>

    {%- comment -%}
Language switcher: stay on same section
{%- endcomment -%}
    <div class="lang-switcher">
      <a href="{{ path | default: '/' }}"
         class="{% if lang == 'en' %}active{% endif %}">
        EN
      </a>

      <a href="/de{{ path }}"
         class="{% if lang == 'de' %}active{% endif %}">
        DE
      </a>

      <a href="/ru{{ path }}"
         class="{% if lang == 'ru' %}active{% endif %}">
        RU
      </a>
    </div>

  </div>
</header>



